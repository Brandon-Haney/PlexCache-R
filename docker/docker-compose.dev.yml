# PlexCache-R Docker Compose - Development Version
# Builds the image locally instead of pulling from Docker Hub
#
# Usage:
#   docker-compose -f docker-compose.dev.yml up -d --build
#   docker-compose -f docker-compose.dev.yml logs -f
#   docker-compose -f docker-compose.dev.yml down

version: "3.8"

services:
  plexcache:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: plexcache-r:dev
    container_name: plexcache-r-dev
    restart: unless-stopped

    environment:
      - PUID=99
      - PGID=100
      - TZ=America/Los_Angeles
      - LOG_LEVEL=DEBUG
      # Note: Plex and Schedule settings configured via Web UI

    volumes:
      # Use local directories for testing
      - ./test-config:/config
      # For actual testing on Unraid, uncomment and adjust:
      # - /mnt/cache:/mnt/cache
      # - /mnt/user0:/mnt/user0
      # - /mnt/user:/mnt/user:ro

    ports:
      - 5757:5757

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5757/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
